{{- $vbase  := .Values.global.vaultBaseURL | required "missing value for .Values.global.vaultBaseURL" -}}
{{- $region := .Values.global.region       | required "missing value for .Values.global.region"       -}}

apiVersion: "openstack.stable.sap.cc/v1"
kind: "OpenstackSeed"
metadata:
  name: cortex-seed
spec:
  requires:
  - {{ .Values.global.keystoneNamespace }}/keystone-seed

  domains:
  - name: Default
    users:
    - name: cortex
      description: "Scheduler service user for CC. This user was automatically generated by a user seed: https://github.com/sapcc/helm-charts/tree/master/openstack/cortex/" 
      password: {{ printf "%s/%s/cortex/keystone-user/password" $vbase $region | quote }}
      role_assignments:
      - project: service
        role:    service

  - name: ccadmin
    projects:
    - name: cortex
      description: "Scheduler for CC. This project was automatically generated by a project seed: https://github.com/sapcc/helm-charts/tree/master/openstack/cortex/"
      role_assignments:
      - user: cortex@Default
        role: member
      - user: cortex@Default
        role: reader
      - user: cortex@Default
        role: cloud_compute_admin
      - user: cortex@Default
        role: cloud_identity_viewer
      - user: cortex@Default
        role: cloud_volume_admin
      - user: cortex@Default
        role: cloud_network_admin
