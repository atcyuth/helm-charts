{{- if .Values.blockrbdpool.enabled }}
---
apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
  name: {{ .Values.blockrbdpool.name }}
spec:
  {{- if .Values.blockrbdpool.pool.failureDomain }}
  failureDomain: {{ .Values.blockrbdpool.pool.failureDomain | default "host"  }}
  {{- end }}
  replicated:
    size: {{ .Values.blockrbdpool.pool.size | default 3 }}
    {{- if .Values.blockrbdpool.pool.replicasPerFailureDomain }}
    replicasPerFailureDomain: {{ .Values.blockrbdpool.pool.replicasPerFailureDomain | default 1 }}
    {{- end }}
    {{- if .Values.blockrbdpool.pool.subFailureDomain }}
    subFailureDomain: {{ .Values.blockrbdpool.pool.subFailureDomain | default "host" }}
    {{- end }}
  {{- if .Values.blockrbdpool.pool.crushRoot }}
  crushRoot: {{ .Values.blockrbdpool.pool.crushRoot | default "default" }} 
  {{- end }}
  deviceClass: nvme
  application: rbd
  parameters:
    pg_num: "1024"
    pgp_num: "1024"
    nodelete: {{ $.Values.pool.nodelete | quote }}
    nosizechange: {{ $.Values.pool.nosizechange | quote }}
{{- end }}
